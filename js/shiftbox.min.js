if("undefined"==typeof jQuery)throw new Error("Shiftbox requires jQuery");!function(a){"use strict";function b(b){return this.each(function(){var d=a(this),e=d.data("shiftbox"),f="object"==typeof b&&b;e||d.data("shiftbox",e=new c(this,f)),("string"==typeof b||b instanceof String)&&e[b].call(d)})}var c=function(b,d){var e=this;e.$element=a(b),e.options=a.extend({},c.DEFAULTS,d),e.initGallery(),e.$element.on("click",function(a){return e.$element.data("lock")!==!0&&void e.open(a)}),e.createModal(),e.current={},e.modalOpened=!1,e.zoomState=!1};c.DEFAULTS={loadingText:"Loading...",errorText:"Preview not available",zoomSwitch:!0,zoomSwitchSelector:"#shiftbox-zoom-switch",modalSelector:"#shiftbox-modal",modalAttachSelector:"body",modalLayout:'<div class="modal fade" tabindex="-1" role="dialog" id="shiftbox-modal"><div class="modal-dialog"><div class="modal-content" style="overflow:hidden"><div class="modal-body" style="padding:0"><div id="shiftbox-picture"></div><div id="shiftbox-button-prev"><img src="/images/shiftbox/prev.png"></div><div id="shiftbox-button-next"><img src="/images/shiftbox/next.png"></div><div id="shiftbox-zoom-switch"><img src="/images/shiftbox/zoom.png"></div><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div></div></div></div>',prevBtnSelector:"#shiftbox-button-prev",nextBtnSelector:"#shiftbox-button-next",pictureSelector:"#shiftbox-picture"},c.prototype.createModal=function(){var b=this,c=a(b.options.modalLayout);"undefined"==typeof b.$modal&&(0===a(b.options.modalSelector).length?a(b.options.modalAttachSelector).prepend(c):c=a(b.options.modalSelector).first(),b.buttons={prev:c.find(b.options.prevBtnSelector).first(),next:c.find(b.options.nextBtnSelector).first(),zoomSwitch:c.find(b.options.zoomSwitchSelector).first()},b.buttons.prev.off("click").on("click",function(){b.prev(b)}),b.buttons.next.off("click").on("click",function(){b.next(b)}),b.buttons.zoomSwitch.off("click").on("click",function(){b.zoomSwitch(b)}),c.on("shown.bs.modal",function(){b.modalOpened=!0}).on("hide.bs.modal",function(){b.modalOpened=!1}),a(window).on("resize",function(){b.modalOpened&&b.fitModal()}),b.$modal=c)},c.prototype.resetModal=function(){var a=this;"undefined"!=typeof a.$modal&&(a.$modal.find(".modal-dialog").removeAttr("style"),a.$modal.find(".modal-content").removeAttr("style").css("overflow","hidden"),a.$modal.find(a.options.pictureSelector).html("").removeAttr("style"))},c.prototype.open=function(b){var c=this,d=a(document).data("shiftbox.gallery"),e=c.gallery;if("object"==typeof b&&"function"==typeof b.preventDefault&&b.preventDefault(),e)for(var f=0;f<d[e].list.length;f++)if(d[e].list[f]===c.$element.attr("href")){d[e].index=f;break}c.checkButtons(c),c.options.zoomSwitch?c.$modal.find(c.options.zoomSwitchSelector).show():c.$modal.find(c.options.zoomSwitchSelector).hide(),c.$modal.modal("show"),c.loadImage(c.$element.attr("href"))},c.prototype.fitModal=function(){var b=this,c=b.getViewport();if(b.current.modalHeight=Math.max(c.height-60,320),b.current.modalWidth=parseInt(.9*c.width)>b.current.baseImg.naturalWidth?b.current.baseImg.naturalWidth:parseInt(.9*c.width),b.current.$baseImg.css({maxWidth:b.zoomState?"unset":b.current.modalWidth,maxHeight:b.zoomState?"unset":b.current.modalHeight,left:b.zoomState?0:"auto",top:0,position:b.zoomState?"absolute":"static",textAlign:b.zoomState?"unset":"center"}),b.current.$picture.html(b.current.$baseImg),b.current.modalHeight=Math.min(b.current.modalHeight,b.current.baseImg.naturalHeight),b.$modal.find(".modal-dialog").css("width",b.current.modalWidth),b.$modal.find(".modal-content").css("height",b.current.modalHeight),!b.zoomState){var d=b.current.modalWidth/b.current.modalHeight,e=b.current.baseImg.naturalWidth/b.current.baseImg.naturalHeight;d<e?b.$modal.find(".modal-content").css("height",b.current.modalWidth/e):b.$modal.find(".modal-dialog").css("width",b.current.modalHeight*e)}b.current.$picture.data("modal-width",b.$modal.find(".modal-dialog").width()).data("modal-height",b.$modal.find(".modal-content").height()).data("picture-width",b.current.baseImg.naturalWidth).data("picture-height",b.current.baseImg.naturalHeight).off("mousemove").on("mousemove",function(a){b.shiftOnMouse(b,a)}).off("touchmove").on("touchmove",function(c){var d=c.originalEvent.touches[0]||c.originalEvent.changedTouches[0],e=a(this).offset();c.pageX=d.pageX-e.left,c.pageY=d.pageY-e.top,c.preventDefault(),c.pageX<a(this).width()&&c.pageX>0&&c.pageY<a(this).height()&&c.pageY>0&&b.shiftOnMouse(b,c)}).css({width:b.current.$picture.data("modal-width"),height:b.current.$picture.data("modal-height")})},c.prototype.getViewport=function(){return{width:Math.max(document.documentElement.clientWidth,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)}},c.prototype.loadImage=function(b){var c=this;c.current.$picture=c.$modal.find(c.options.pictureSelector),c.current.baseImg=new Image,c.current.$baseImg=a(c.current.baseImg),c.zoomState=!1,c.current.baseImg.onload=function(){c.fitModal()},c.current.baseImg.onerror=function(){c.resetModal(),c.current.$picture.html('<p style="margin:20px">'+c.options.errorText+"</p>")},c.current.$picture.html('<p style="margin:20px">'+c.options.loadingText+"</p>"),c.current.baseImg.src=b},c.prototype.initGallery=function(){var b=this,c=b.$element.data("gallery"),d=a(document).data("shiftbox.gallery")?a(document).data("shiftbox.gallery"):{};if(c){d[c]={index:0,list:[]},b.gallery=c,a('[data-toggle="shiftbox"][data-gallery="'+c+'"]').each(function(){d[c].list.push(a(this).attr("href"))});for(var e=0;e<d[c].list.length;e++)if(d[c].list[e]===b.$element.attr("href")){d[c].index=e;break}}a(document).data("shiftbox.gallery",d)},c.prototype.prev=function(b){if(b.gallery){var c=b.gallery,d=a(document).data("shiftbox.gallery");d[c].index>0?d[c].index--:d[c].index=0,b.checkButtons(b),b.loadImage(d[c].list[d[c].index])}},c.prototype.next=function(b){if(b.gallery){var c=b.gallery,d=a(document).data("shiftbox.gallery");d[c].index<d[c].list.length-1?d[c].index++:d[c].index=d[c].list.length,b.checkButtons(b),b.loadImage(d[c].list[d[c].index])}},c.prototype.zoomSwitch=function(a){a.zoomState=!a.zoomState,a.fitModal()},c.prototype.checkButtons=function(b){var c=a(document).data("shiftbox.gallery");if(b.gallery){var d=b.gallery;c[d].index>0?b.buttons.prev.show():b.buttons.prev.hide(),c[d].index<c[d].list.length-1?b.buttons.next.show():b.buttons.next.hide()}else b.buttons.next.hide(),b.buttons.prev.hide()},c.prototype.close=function(a){var b=this;b.$modal.modal("hide"),a&&a.preventDefault()},c.prototype.shiftOnMouse=function(b,c){if(b.zoomState){var d=b.current.$picture.data("picture-width")>b.current.$picture.data("modal-width"),e=b.current.$picture.data("picture-height")>a(window).height()-60,f=c.pageX-b.current.$picture.offset().left,g=c.pageY-b.current.$picture.offset().top;d&&b.current.$picture.find("img").css("left",-parseInt(f*b.current.$picture.data("picture-width")/b.current.$picture.data("modal-width"))+f),e&&b.current.$picture.find("img").css("top",-parseInt(g*b.current.$picture.data("picture-height")/b.current.$picture.data("modal-height"))+g)}},c.prototype.destroy=function(){var b=this,c=a(this);b.$modal&&b.$modal.remove(),c.data("shiftbox",void 0),b.prototype.open=function(){}},a.fn.shiftbox=b,a.fn.shiftbox.Constructor=c}(jQuery);